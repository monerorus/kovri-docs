# Monero поверх Kovri

## Начало работы

1. Следуйте инструкциям для сборки и\или установки [Kovri](https://github.com/monero-project/kovri) & [Monero](https://github.com/monero-project/monero)
2. Ознакомьтесь с [Руководством пользователя](https://github.com/monero-project/kovri-docs/blob/master/i18n/ru/user_guide.md) выбрав ваш язык
3. Настройте серверные и клиентские Kovri тунели для подключения узлов `monerod` через I2P сеть

## Kovri серверный тунель

Сперва, настройте серверный тунель для одного узла

Для установки серверного тунеля смотрите `tunnels.conf` находящийся в папке с данными. Чтобы узнать вашу папку с данными, смотри `kovri.conf`.

```
[XMR_P2P_Server]
type = server
address = 127.0.0.1
port = 28080
in_port = 28080
keys = xmr-p2p-keys.dat
;white_list =
;black_list =
```

Эта конфигурация откроет слушателя Kovri на P2P порту по умолчанию для тестовой сети `monerod`. Далее, прочитайте [Руководство пользователя](https://github.com/monero-project/kovri-docs/blob/master/i18n/ru/user_guide.md) чтобы узнать как получить base32 адрес назначения.

Если ваш kovri маршрутизатор уже запущен, выполните `$ kill -HUP $(pgrep kovri)` для подгрузки нового тунеля. Более радикально, вы можете выполнить жесткую перезагрузку путем остановки и запуска kovri.

## Kovri клиентский тунель

Когда серверный тунель установлен начните настройку клиентского тунеля указывающего на севрерный тунель

Пример:

```
[XMR_Client]
type = client
address = 127.0.0.1
port = 24040
dest = ваш-скопированный-севрер-назначения.b32.i2p
dest_port = 28080
keys = xmr-client-keys.dat
```

Повторите процес для каждого узла, который вы хотите подключить используя Kovri.

Если ваш kovri маршрутизатор уже запущен, выполните `$ kill -HUP $(pgrep kovri)` для подгрузки нового тунеля. Более радикально, вы можете выполнить жесткую перезагрузку путем остановки и запуска kovri.

## Monero P2P поверх Kovri

Направить `monerod` в ваш новый клиентский тунель Kovri очень просто.

Вот пример как начать майнинг на узле в тестовой сети:

```bash
monerod --testnet --start-mining your-testnet-wallet-address --add-exclusive-node 127.0.0.1:24040
```

Если вы заметили проблемы с подключением, подождите пока ваши Kovri узлы интегрируются в сеть (~5-10 мин после запуска).

## Monero RPC поверх Kovri

Публикация RPC сервиса Monero через Kovri очень позожий процесс.

Настройте серверный тунель на вашем узле Kovri:

```
[XMR_RPC_Server]
type = server
address = 127.0.0.1
port = 28081
in_port = 28081
keys = xmr-rpc-keys.dat
;white_list =
;black_list =
```

В результате будет сгенерирован новый набор ключей и новый адрес назначения.

Чтобы использовать тот же адрес назначения что и для P2P, просто замените `xmr-rpc-keys.dat` на `xmr-p2p-keys.dat` выше в конфигурации.

Если ваш kovri маршрутизатор уже запущен, выполните `$ kill -HUP $(pgrep kovri)` для подгрузки нового тунеля. Более радикально, вы можете выполнить жесткую перезагрузку путем остановки и запуска kovri.

Этот тунель опубликует `monerod` JSON RPC для тестовой сети по умолчанию, и можно использовать Kovri HTTP в клиентском тунеледля подключения.

Вот пример для подключения через curl с клиентского узла Kovri:

```bash
export http_proxy=127.0.0.1:4446 rpc_server=http://ваш-скопированный-севрер-назначения.b32.i2p:28081
curl -X POST ${rpc_server}/json_rpc -d '{"jsonrpc":"2.0","id":"0","method":"get_height"}' -H 'Content-Type: application/json'
```
